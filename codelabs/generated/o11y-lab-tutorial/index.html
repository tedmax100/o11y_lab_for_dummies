
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>OpenTelemetry å¯è§€æ¸¬æ€§å¯¦é©—å®¤æ•™å­¸</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="o11y-lab-tutorial"
                  title="OpenTelemetry å¯è§€æ¸¬æ€§å¯¦é©—å®¤æ•™å­¸"
                  environment="web"
                  feedback-link="https://github.com/tedmax100/o11y_lab_for_dummies/issues/new?template=codelabs-feedback.md&amp;labels=codelabs,documentation">
    
      <google-codelab-step label="èª²ç¨‹ç°¡ä»‹" duration="2">
        <h2 is-upgraded>ä½ å°‡å­¸åˆ°ä»€éº¼</h2>
<p>åœ¨é€™å€‹å¯¦é©—å®¤ä¸­ï¼Œä½ å°‡å­¸ç¿’å¦‚ä½•ï¼š</p>
<ul>
<li>æ­å»ºå®Œæ•´çš„å¯è§€æ¸¬æ€§ç’°å¢ƒï¼ˆGrafana + Prometheus + Loki + Tempoï¼‰</li>
<li>ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²å¾®æœå‹™æ¶æ§‹</li>
<li>ç†è§£ Python è‡ªå‹•åŸ‹é»ï¼ˆAuto Instrumentationï¼‰</li>
<li>å¯¦è¸ Python æ‰‹å‹•åŸ‹é»ï¼ˆManual Instrumentationï¼‰</li>
<li>ä½¿ç”¨ K6 ç”Ÿæˆæ¸¬è©¦æµé‡</li>
<li>ä½¿ç”¨ Pumba é€²è¡Œæ··æ²Œå·¥ç¨‹ï¼ˆå»¶é²æ³¨å…¥ï¼‰</li>
<li>åœ¨ Grafana ä¸­é—œè¯ Logsã€Metricsã€Traces</li>
</ul>
<h2 is-upgraded>å‰ç½®è¦æ±‚</h2>
<ul>
<li>åŸºæœ¬çš„ Linux å‘½ä»¤åˆ—çŸ¥è­˜</li>
<li>ç†è§£ Docker åŸºç¤æ¦‚å¿µ</li>
<li>Python æˆ– Go ç¨‹å¼è¨­è¨ˆåŸºç¤</li>
</ul>
<h2 is-upgraded>å¯¦é©—ç’°å¢ƒ</h2>
<ul>
<li>Ubuntu/MacOS/Windows (WSL2)</li>
<li>è‡³å°‘ 8GB RAM</li>
<li>20GB å¯ç”¨ç£ç¢Ÿç©ºé–“</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="ç’°å¢ƒæº–å‚™ - Docker &amp; Docker Compose" duration="10">
        <h2 is-upgraded>å®‰è£ Docker</h2>
<h3 is-upgraded>Linux (Ubuntu/Debian)</h3>
<pre><code language="language-bash" class="language-bash"># æ›´æ–°è»Ÿé«”å¥—ä»¶ç´¢å¼•
sudo apt-get update

# å®‰è£ç›¸ä¾å¥—ä»¶
sudo apt-get install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# æ–°å¢ Docker å®˜æ–¹ GPG key
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# è¨­å®šå„²å­˜åº«
echo \
  &#34;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable&#34; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null

# å®‰è£ Docker Engine
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# å°‡ç›®å‰ä½¿ç”¨è€…åŠ å…¥ docker ç¾¤çµ„
sudo usermod -aG docker $USER
newgrp docker
</code></pre>
<h3 is-upgraded>MacOS</h3>
<pre><code language="language-bash" class="language-bash"># ä½¿ç”¨ Homebrew å®‰è£
brew install --cask docker

# æˆ–è€…ç›´æ¥ä¸‹è¼‰ Docker Desktop
# https://www.docker.com/products/docker-desktop/
</code></pre>
<h3 is-upgraded>Windows</h3>
<p>ä¸‹è¼‰ä¸¦å®‰è£ Docker Desktop for Windows: https://www.docker.com/products/docker-desktop/</p>
<h2 is-upgraded>é©—è­‰å®‰è£</h2>
<pre><code language="language-bash" class="language-bash"># æª¢æŸ¥ Docker ç‰ˆæœ¬
docker --version
# æ‡‰é¡¯ç¤º: Docker version 24.0.0 æˆ–æ›´é«˜

# æª¢æŸ¥ Docker Compose
docker compose version
# æ‡‰é¡¯ç¤º: Docker Compose version v2.20.0 æˆ–æ›´é«˜

# æ¸¬è©¦ Docker é‹ä½œ
docker run hello-world
</code></pre>
<p>Positive : å¦‚æœçœ‹åˆ° &#34;Hello from Docker!&#34; è¨Šæ¯ï¼Œè¡¨ç¤º Docker å®‰è£æˆåŠŸï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="ç’°å¢ƒæº–å‚™ - Python &amp; Go" duration="8">
        <h2 is-upgraded>å®‰è£ Python 3.11+</h2>
<h3 is-upgraded>Linux (Ubuntu/Debian)</h3>
<pre><code language="language-bash" class="language-bash"># æ–°å¢ deadsnakes PPA
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt-get update

# å®‰è£ Python 3.11
sudo apt-get install -y python3.11 python3.11-venv python3.11-dev

# å®‰è£ pip
curl -sS https://bootstrap.pypa.io/get-pip.py | python3.11

# é©—è­‰å®‰è£
python3.11 --version
pip3.11 --version
</code></pre>
<h3 is-upgraded>MacOS</h3>
<pre><code language="language-bash" class="language-bash">brew install python@3.11

# é©—è­‰
python3.11 --version
</code></pre>
<h3 is-upgraded>Windows</h3>
<p>ä¸‹è¼‰ä¸¦å®‰è£ Python 3.11: https://www.python.org/downloads/</p>
<h2 is-upgraded>å®‰è£ Go 1.21+</h2>
<h3 is-upgraded>Linux</h3>
<pre><code language="language-bash" class="language-bash"># ä¸‹è¼‰ Go
wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz

# è§£å£“ç¸®åˆ° /usr/local
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz

# æ–°å¢åˆ° PATH (åŠ å…¥ ~/.bashrc æˆ– ~/.zshrc)
echo &#39;export PATH=$PATH:/usr/local/go/bin&#39; &gt;&gt; ~/.bashrc
source ~/.bashrc

# é©—è­‰
go version
</code></pre>
<h3 is-upgraded>MacOS</h3>
<pre><code language="language-bash" class="language-bash">brew install go@1.21

# é©—è­‰
go version
</code></pre>
<h3 is-upgraded>Windows</h3>
<p>ä¸‹è¼‰ä¸¦å®‰è£ Go: https://go.dev/dl/</p>
<h2 is-upgraded>å®‰è£ K6</h2>
<p>K6 æ˜¯ä¸€å€‹ç¾ä»£åŒ–çš„è² è¼‰æ¸¬è©¦å·¥å…·ã€‚</p>
<h3 is-upgraded>Linux</h3>
<pre><code language="language-bash" class="language-bash">sudo gpg -k
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo &#34;deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main&#34; | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6

# é©—è­‰
k6 version
</code></pre>
<h3 is-upgraded>MacOS</h3>
<pre><code language="language-bash" class="language-bash">brew install k6

# é©—è­‰
k6 version
</code></pre>
<h3 is-upgraded>ä½¿ç”¨ Docker (è·¨å¹³å°)</h3>
<pre><code language="language-bash" class="language-bash">docker pull grafana/k6:latest
docker run --rm -i grafana/k6 version
</code></pre>
<p>Positive : æ‰€æœ‰å·¥å…·å®‰è£å®Œæˆï¼ç¾åœ¨å¯ä»¥é–‹å§‹å¯¦é©—äº†ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="è¤‡è£½å°ˆæ¡ˆä¸¦å•Ÿå‹•ç’°å¢ƒ" duration="5">
        <h2 is-upgraded>å–å¾—å°ˆæ¡ˆç¨‹å¼ç¢¼</h2>
<pre><code language="language-bash" class="language-bash"># è¤‡è£½å„²å­˜åº«
git clone https://github.com/yourusername/o11y_lab_for_dummies.git
cd o11y_lab_for_dummies

# æŸ¥çœ‹å°ˆæ¡ˆçµæ§‹
ls -la
</code></pre>
<h2 is-upgraded>å•Ÿå‹•æ‰€æœ‰æœå‹™</h2>
<pre><code language="language-bash" class="language-bash"># ä½¿ç”¨ Docker Compose å•Ÿå‹•
docker compose up -d

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker compose ps

# æŸ¥çœ‹æ—¥èªŒï¼ˆé¸ç”¨ï¼‰
docker compose logs -f
</code></pre>
<p>ä½ æ‡‰è©²æœƒçœ‹åˆ°ä»¥ä¸‹æœå‹™å•Ÿå‹•ï¼š</p>
<ul>
<li><strong>api-gateway</strong>: Python FastAPI é–˜é“å™¨</li>
<li><strong>service-a</strong>: Python FastAPI æœå‹™ï¼ˆè‡ªå‹•åŸ‹é»ï¼‰</li>
<li><strong>service-b</strong>: Go æœå‹™ï¼ˆæ‰‹å‹•åŸ‹é»ï¼‰</li>
<li><strong>service-c</strong>: Go æœå‹™ï¼ˆæ‰‹å‹•åŸ‹é»ï¼‰</li>
<li><strong>service-d</strong>: Python Flask æœå‹™ï¼ˆè‡ªå‹•åŸ‹é»ï¼‰</li>
<li><strong>grafana</strong>: è¦–è¦ºåŒ–å¹³å°</li>
<li><strong>prometheus</strong>: Metrics å„²å­˜</li>
<li><strong>loki</strong>: æ—¥èªŒå„²å­˜</li>
<li><strong>tempo</strong>: Trace å„²å­˜</li>
<li><strong>otel-collector</strong>: OpenTelemetry æ”¶é›†å™¨</li>
<li><strong>postgres</strong>: è³‡æ–™åº«</li>
<li><strong>kafka</strong>: è¨Šæ¯ä½‡åˆ—</li>
</ul>
<h2 is-upgraded>ç­‰å¾…æœå‹™å°±ç·’</h2>
<pre><code language="language-bash" class="language-bash"># æª¢æŸ¥æ‰€æœ‰å®¹å™¨æ˜¯å¦å¥åº·
docker compose ps

# ç­‰å¾…ç´„ 30-60 ç§’è®“æ‰€æœ‰æœå‹™å•Ÿå‹•å®Œæˆ
</code></pre>
<p>Positive : æ‰€æœ‰æœå‹™å•Ÿå‹•å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥å­˜å– Grafana äº†ï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="å­˜å– Grafana å¹³å°" duration="10">
        <h2 is-upgraded>ç™»å…¥ Grafana</h2>
<ol type="1">
<li>é–‹å•Ÿç€è¦½å™¨å­˜å–: <strong>http://localhost:3000</strong></li>
<li>ä½¿ç”¨é è¨­æ†‘è­‰ç™»å…¥:<ul>
<li><strong>ä½¿ç”¨è€…åç¨±</strong>: <code>admin</code></li>
<li><strong>å¯†ç¢¼</strong>: <code>admin</code></li>
</ul>
</li>
<li>é¦–æ¬¡ç™»å…¥æœƒæç¤ºä¿®æ”¹å¯†ç¢¼ï¼Œå¯ä»¥é¸æ“‡è·³éï¼ˆSkipï¼‰</li>
</ol>
<h2 is-upgraded>Grafana ä»‹é¢ä»‹ç´¹</h2>
<p>ç™»å…¥å¾Œä½ æœƒçœ‹åˆ° Grafana ä¸»ä»‹é¢ï¼š</p>
<p class="image-container"><img alt="Grafana Home" src="img/0.png"></p>
<h3 is-upgraded>å·¦å´é¸å–®åˆ—</h3>
<ul>
<li><strong>Home</strong>: é¦–é </li>
<li><strong>Dashboards</strong>: å„€è¡¨æ¿æ¸…å–®</li>
<li><strong>Explore</strong>: è³‡æ–™æ¢ç´¢ä»‹é¢ï¼ˆæˆ‘å€‘ä¸»è¦ä½¿ç”¨é€™å€‹ï¼‰</li>
<li><strong>Alerting</strong>: å‘Šè­¦é…ç½®</li>
<li><strong>Configuration</strong>: é…ç½®é¸é …</li>
</ul>
<h2 is-upgraded>æŸ¥çœ‹è³‡æ–™ä¾†æº</h2>
<ol type="1">
<li>é»æ“Šå·¦å´é¸å–®çš„é½’è¼ªåœ–ç¤º (Configuration)</li>
<li>é¸æ“‡ <strong>Data sources</strong></li>
<li>ä½ æ‡‰è©²æœƒçœ‹åˆ°ä»¥ä¸‹è³‡æ–™ä¾†æºå·²é…ç½®: <ul>
<li><strong>Prometheus</strong>: Metrics è³‡æ–™</li>
<li><strong>Loki</strong>: æ—¥èªŒè³‡æ–™</li>
<li><strong>Tempo</strong>: Trace è³‡æ–™</li>
</ul>
</li>
</ol>
<p class="image-container"><img alt="Data Sources" src="img/0.png"></p>
<h2 is-upgraded>æ¢ç´¢é å…ˆé…ç½®çš„ Dashboard</h2>
<ol type="1">
<li>é»æ“Šå·¦å´é¸å–®çš„ Dashboard åœ–ç¤º</li>
<li>ä½ æœƒçœ‹åˆ°é å…ˆé…ç½®çš„å„€è¡¨æ¿: <ul>
<li><strong>OpenTelemetry Overview</strong>: æ•´é«”æ¦‚è¦½</li>
<li><strong>Service Performance</strong>: æœå‹™æ•ˆèƒ½ç›£æ§</li>
<li><strong>Distributed Tracing</strong>: åˆ†æ•£å¼è¿½è¹¤</li>
</ul>
</li>
</ol>
<p class="image-container"><img alt="Dashboards" src="img/0.png"></p>
<p>Positive : Grafana å¹³å°å·²ç¶“æº–å‚™å¥½äº†ï¼æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä½¿ç”¨ K6 ç”Ÿæˆæµé‡ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ä½¿ç”¨ K6 ç”Ÿæˆæ¸¬è©¦æµé‡" duration="8">
        <h2 is-upgraded>K6 æ¸¬è©¦è…³æœ¬</h2>
<p>å°ˆæ¡ˆä¸­å·²ç¶“åŒ…å«äº† K6 æ¸¬è©¦è…³æœ¬ã€‚è®“æˆ‘å€‘æŸ¥çœ‹ä¸¦åŸ·è¡Œå®ƒï¼š</p>
<pre><code language="language-bash" class="language-bash"># æŸ¥çœ‹ K6 è…³æœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
cat k6/load-test.js
</code></pre>
<p>å¦‚æœå°ˆæ¡ˆä¸­æ²’æœ‰ï¼Œå»ºç«‹ä¸€å€‹ç°¡å–®çš„ K6 è…³æœ¬ï¼š</p>
<pre><code language="language-bash" class="language-bash">mkdir -p k6
cat &gt; k6/load-test.js &lt;&lt; &#39;EOF&#39;
import http from &#39;k6/http&#39;;
import { check, sleep } from &#39;k6&#39;;

export const options = {
  stages: [
    { duration: &#39;30s&#39;, target: 10 },  // çˆ¬å‡åˆ° 10 å€‹ä½¿ç”¨è€…
    { duration: &#39;1m&#39;, target: 10 },   // ä¿æŒ 10 å€‹ä½¿ç”¨è€…
    { duration: &#39;30s&#39;, target: 0 },   // é™åˆ° 0
  ],
};

export default function () {
  const response = http.get(&#39;http://localhost:8080/api/process&#39;);

  check(response, {
    &#39;status is 200&#39;: (r) =&gt; r.status === 200,
    &#39;response time &lt; 500ms&#39;: (r) =&gt; r.timings.duration &lt; 500,
  });

  sleep(1);
}
EOF
</code></pre>
<h2 is-upgraded>åŸ·è¡Œ K6 æ¸¬è©¦</h2>
<pre><code language="language-bash" class="language-bash"># åŸ·è¡Œè² è¼‰æ¸¬è©¦
k6 run k6/load-test.js
</code></pre>
<p>ä½ æœƒçœ‹åˆ°é¡ä¼¼é€™æ¨£çš„è¼¸å‡ºï¼š</p>
<pre><code>     âœ“ status is 200
     âœ“ response time &lt; 500ms

     checks.........................: 100.00% âœ“ 200  âœ— 0
     data_received..................: 1.2 MB  20 kB/s
     data_sent......................: 24 kB   400 B/s
     http_req_duration..............: avg=125ms min=50ms med=120ms max=300ms
</code></pre>
<h2 is-upgraded>åœ¨ Grafana ä¸­è§€å¯Ÿæµé‡</h2>
<ol type="1">
<li>åœ¨ Grafana ä¸­é–‹å•Ÿ <strong>Explore</strong></li>
<li>é¸æ“‡è³‡æ–™ä¾†æº: <strong>Prometheus</strong></li>
<li>è¼¸å…¥æŸ¥è©¢: <pre><code language="language-promql" class="language-promql">rate(http_requests_total[1m])
</code></pre>
</li>
<li>é»æ“Š <strong>Run query</strong></li>
</ol>
<p>ä½ æ‡‰è©²æœƒçœ‹åˆ°è«‹æ±‚é€Ÿç‡çš„åœ–è¡¨ï¼š</p>
<p class="image-container"><img alt="K6 Traffic" src="img/0.png"></p>
<h2 is-upgraded>æŒçºŒæµé‡ç”Ÿæˆï¼ˆé¸ç”¨ï¼‰</h2>
<p>å¦‚æœæƒ³è¦æŒçºŒç”Ÿæˆæµé‡ç”¨æ–¼å¾ŒçºŒå¯¦é©—ï¼š</p>
<pre><code language="language-bash" class="language-bash"># èƒŒæ™¯åŸ·è¡Œ K6
k6 run --duration 30m k6/load-test.js &amp;
</code></pre>
<p>Positive : ç¾åœ¨æˆ‘å€‘æœ‰æµé‡è³‡æ–™äº†ï¼æ¥ä¸‹ä¾†æ³¨å…¥ä¸€äº›æ··æ²Œã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="æ··æ²Œå·¥ç¨‹å…¥é–€ - Pumba åŸºç¤" duration="8">
        <h2 is-upgraded>ä»€éº¼æ˜¯æ··æ²Œå·¥ç¨‹ï¼Ÿ</h2>
<p>æ··æ²Œå·¥ç¨‹æ˜¯ä¸€ç¨®é€é<strong>ä¸»å‹•æ³¨å…¥æ•…éšœ</strong>ä¾†æ¸¬è©¦ç³»çµ±éŸŒæ€§çš„å¯¦è¸æ–¹æ³•ã€‚åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œæœå‹™å¯èƒ½é‡åˆ°ï¼š</p>
<ul>
<li>ğŸŒ ç¶²è·¯å»¶é²æˆ–æ–·ç·š</li>
<li>ğŸ’¥ æœå‹™çªç„¶å´©æ½°</li>
<li>ğŸ“‰ è³‡æºä¸è¶³ï¼ˆCPUã€è¨˜æ†¶é«”ï¼‰</li>
<li>ğŸ”Œ ä¾è³´æœå‹™å¤±æ•ˆ</li>
</ul>
<p>é€éæ··æ²Œæ¸¬è©¦ï¼Œæˆ‘å€‘å¯ä»¥ï¼š</p>
<ol type="1">
<li>é©—è­‰ç³»çµ±çš„å®¹éŒ¯èƒ½åŠ›</li>
<li>ç™¼ç¾éš±è—çš„å–®é»æ•…éšœ</li>
<li>æ¸¬è©¦ç›£æ§å’Œå‘Šè­¦æ˜¯å¦æœ‰æ•ˆ</li>
<li>æå‡åœ˜éšŠçš„æ‡‰è®Šèƒ½åŠ›</li>
</ol>
<h2 is-upgraded>Pumba ç°¡ä»‹</h2>
<p>Pumba æ˜¯ä¸€å€‹å°ˆç‚º Docker å®¹å™¨è¨­è¨ˆçš„æ··æ²Œå·¥ç¨‹å·¥å…·ï¼Œæ”¯æ´ï¼š</p>
<ul>
<li><strong>ç¶²è·¯æ··æ²Œ</strong>ï¼šå»¶é²ã€ä¸ŸåŒ…ã€é »å¯¬é™åˆ¶</li>
<li><strong>å®¹å™¨æ··æ²Œ</strong>ï¼šéš¨æ©Ÿçµ‚æ­¢ã€æš«åœã€è³‡æºé™åˆ¶</li>
<li><strong>éˆæ´»æ§åˆ¶</strong>ï¼šæŒ‡å®šæŒçºŒæ™‚é–“ã€ç›®æ¨™å®¹å™¨ã€æ•…éšœå¼·åº¦</li>
</ul>
<p><strong>æœ€æ£’çš„æ˜¯</strong>ï¼šæˆ‘å€‘å·²ç¶“åœ¨ Makefile ä¸­æ•´åˆäº† Pumbaï¼Œç„¡éœ€å®‰è£ï¼</p>
<h2 is-upgraded>æŸ¥çœ‹å¯ç”¨çš„æ··æ²Œæ¸¬è©¦å‘½ä»¤</h2>
<pre><code language="language-bash" class="language-bash"># æŸ¥çœ‹æ‰€æœ‰æ··æ²Œæ¸¬è©¦å‘½ä»¤
make chaos-help
</code></pre>
<p>ä½ æœƒçœ‹åˆ°ï¼š</p>
<ul>
<li>åŸºç¤æ··æ²Œæ¸¬è©¦ï¼ˆç¶²è·¯å»¶é²ã€ä¸ŸåŒ…ã€å®¹å™¨çµ‚æ­¢ï¼‰</li>
<li>æœå‹™ç‰¹å®šæ¸¬è©¦ï¼ˆé‡å°å–®ä¸€æœå‹™ï¼‰</li>
<li>è¤‡é›œå ´æ™¯ï¼ˆæ¨¡æ“¬çœŸå¯¦æ•…éšœï¼‰</li>
</ul>
<p>Positive : <strong>æç¤º</strong>ï¼šæ‰€æœ‰æ··æ²Œæ¸¬è©¦éƒ½ä½¿ç”¨ Docker é‹è¡Œ Pumbaï¼Œä¸éœ€è¦é¡å¤–å®‰è£ä»»ä½•å·¥å…·ï¼</p>
<h2 is-upgraded>ç¬¬ä¸€å€‹æ··æ²Œæ¸¬è©¦ - ç¶²è·¯å»¶é²</h2>
<p>è®“æˆ‘å€‘å¾æœ€ç°¡å–®çš„æ¸¬è©¦é–‹å§‹ï¼šçµ¦ Service A æ·»åŠ  1 ç§’çš„ç¶²è·¯å»¶é²ã€‚</p>
<pre><code language="language-bash" class="language-bash"># çµ¦ Service A æ·»åŠ  1000ms å»¶é²ï¼ŒæŒçºŒ 3 åˆ†é˜
make chaos-delay-service-a
</code></pre>
<p>ä½ æœƒçœ‹åˆ°ï¼š</p>
<pre><code>ğŸŒ çµ¦ Service A æ·»åŠ  1000ms å»¶é²ï¼ŒæŒçºŒ 3 åˆ†é˜
âœ… Service A å»¶é²å·²æ‡‰ç”¨
</code></pre>
<h2 is-upgraded>åœ¨ Grafana ä¸­è§€å¯Ÿå½±éŸ¿</h2>
<p>ç¾åœ¨æ··æ²Œæ¸¬è©¦æ­£åœ¨é‹è¡Œï¼Œè®“æˆ‘å€‘åœ¨ Grafana ä¸­è§€å¯Ÿå½±éŸ¿ï¼š</p>
<ol type="1">
<li><strong>åŒæ™‚ç”Ÿæˆæ¸¬è©¦æµé‡</strong>ï¼š<pre><code language="language-bash" class="language-bash">k6 run k6/load-test.js
</code></pre>
</li>
<li><strong>åœ¨ Grafana ä¸­æŸ¥çœ‹å»¶é²æŒ‡æ¨™</strong>ï¼š<ul>
<li>æ‰“é–‹ Grafana: http://localhost:3000</li>
<li>é€²å…¥ Explore</li>
<li>é¸æ“‡ Prometheus æ•¸æ“šæº</li>
<li>åŸ·è¡ŒæŸ¥è©¢ï¼š</li>
</ul>
<pre><code language="language-promql" class="language-promql">histogram_quantile(0.95,
  rate(http_server_duration_milliseconds_bucket{service_name=&#34;service-a&#34;}[1m])
)
</code></pre>
</li>
<li><strong>è§€å¯Ÿçµæœ</strong>ï¼š<ul>
<li>æ­£å¸¸æƒ…æ³ï¼šP95 å»¶é²ç´„ 50-100ms</li>
<li>æ··æ²Œæ³¨å…¥å¾Œï¼šP95 å»¶é²ä¸Šå‡åˆ° 1000ms ä»¥ä¸Š</li>
</ul>
</li>
</ol>
<p class="image-container"><img alt="Pumba Delay Effect" src="img/0.png"></p>
<h2 is-upgraded>åœæ­¢æ··æ²Œæ¸¬è©¦</h2>
<p>3 åˆ†é˜å¾Œï¼Œæ¸¬è©¦æœƒè‡ªå‹•åœæ­¢ã€‚æˆ–è€…æ‰‹å‹•åœæ­¢ï¼š</p>
<pre><code language="language-bash" class="language-bash"># åœæ­¢æ‰€æœ‰æ··æ²Œæ¸¬è©¦
make chaos-stop

# æ¸…ç† Pumba å®¹å™¨
make chaos-clean
</code></pre>
<h2 is-upgraded>æŸ¥çœ‹æ··æ²Œæ¸¬è©¦ç‹€æ…‹</h2>
<pre><code language="language-bash" class="language-bash"># æŸ¥çœ‹ç•¶å‰é‹è¡Œçš„æ··æ²Œæ¸¬è©¦
make chaos-status
</code></pre>
<p>Negative : <strong>é‡è¦æé†’</strong>ï¼šæ··æ²Œæ¸¬è©¦æœƒçœŸå¯¦å½±éŸ¿æœå‹™æ•ˆèƒ½ã€‚å¯¦é©—å®Œæˆå¾Œè¨˜å¾—åœæ­¢æ¸¬è©¦ï¼Œé¿å…å½±éŸ¿å¾ŒçºŒæ­¥é©Ÿï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="æ··æ²Œå·¥ç¨‹é€²éš - å®Œæ•´æ··æ²Œæ¸¬è©¦æŒ‡å—" duration="20">
        <p>ç¾åœ¨ä½ å·²ç¶“äº†è§£åŸºç¤ï¼Œè®“æˆ‘å€‘æ¢ç´¢æ›´å¤šæ··æ²Œæ¸¬è©¦å ´æ™¯ã€‚æœ¬ç« ç¯€å°‡æŒ‰é›£åº¦å¾ªåºæ¼¸é€²ä»‹ç´¹ã€‚</p>
<h2 is-upgraded>Level 1ï¼šåŸºç¤ç¶²è·¯æ··æ²Œ â­</h2>
<p>é€™äº›æ¸¬è©¦é©åˆåˆå­¸è€…ï¼Œå¹«åŠ©ä½ ç†è§£ç¶²è·¯å•é¡Œå°ç³»çµ±çš„å½±éŸ¿ã€‚</p>
<h3 is-upgraded>1.1 ç¶²è·¯å»¶é²ï¼ˆæ‰€æœ‰æœå‹™ï¼‰</h3>
<pre><code language="language-bash" class="language-bash"># çµ¦æ‰€æœ‰æ‡‰ç”¨æœå‹™æ·»åŠ  500ms å»¶é²ï¼ŒæŒçºŒ 5 åˆ†é˜
make chaos-network-delay
</code></pre>
<p><strong>é©ç”¨å ´æ™¯</strong>ï¼š</p>
<ul>
<li>æ¨¡æ“¬è·¨å€åŸŸç¶²è·¯</li>
<li>æ¸¬è©¦è¶…æ™‚è¨­å®šæ˜¯å¦åˆç†</li>
<li>é©—è­‰ç”¨æˆ¶é«”é©—é™ç´šç­–ç•¥</li>
</ul>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>æ•´é«”ç³»çµ±çš„å›æ‡‰æ™‚é–“</li>
<li>æ˜¯å¦æœ‰æœå‹™å› è¶…æ™‚è€Œå¤±æ•—</li>
<li>Grafana ä¸­çš„ Trace éˆè·¯å»¶é²</li>
</ul>
<h3 is-upgraded>1.2 ç¶²è·¯ä¸ŸåŒ…</h3>
<pre><code language="language-bash" class="language-bash"># çµ¦æ‰€æœ‰æœå‹™æ·»åŠ  20% ä¸ŸåŒ…ç‡ï¼ŒæŒçºŒ 5 åˆ†é˜
make chaos-network-loss
</code></pre>
<p><strong>é©ç”¨å ´æ™¯</strong>ï¼š</p>
<ul>
<li>æ¨¡æ“¬ä¸ç©©å®šçš„ç¶²è·¯ç’°å¢ƒ</li>
<li>æ¸¬è©¦é‡è©¦æ©Ÿåˆ¶</li>
<li>é©—è­‰éŒ¯èª¤è™•ç†</li>
</ul>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>éŒ¯èª¤ç‡æ˜¯å¦ä¸Šå‡</li>
<li>é‡è©¦é‚è¼¯æ˜¯å¦ç”Ÿæ•ˆ</li>
<li>Logs ä¸­çš„éŒ¯èª¤è¨Šæ¯</li>
</ul>
<h3 is-upgraded>1.3 ç¶²è·¯åŒ…æå£</h3>
<pre><code language="language-bash" class="language-bash"># çµ¦æ‰€æœ‰æœå‹™æ·»åŠ  10% åŒ…æå£ç‡ï¼ŒæŒçºŒ 5 åˆ†é˜
make chaos-network-corrupt
</code></pre>
<p><strong>é©ç”¨å ´æ™¯</strong>ï¼š</p>
<ul>
<li>æ¸¬è©¦è³‡æ–™å®Œæ•´æ€§é©—è­‰</li>
<li>æ¨¡æ“¬ç¡¬é«”æ•…éšœ</li>
<li>é©—è­‰å”å®šçš„éŒ¯èª¤æª¢æ¸¬èƒ½åŠ›</li>
</ul>
<p>Positive : <strong>å°æŠ€å·§</strong>ï¼šå¯ä»¥åŒæ™‚åœ¨å¦ä¸€å€‹çµ‚ç«¯è¦–çª—é‹è¡Œ <code>make chaos-status</code> ä¾†å³æ™‚ç›£æ§æ··æ²Œæ¸¬è©¦ç‹€æ…‹ã€‚</p>
<h2 is-upgraded>Level 2ï¼šæœå‹™ç‰¹å®šæ··æ²Œ â­â­</h2>
<p>é‡å°å–®ä¸€æœå‹™é€²è¡Œæ¸¬è©¦ï¼Œæ›´ç²¾ç¢ºåœ°æ¨¡æ“¬ç‰¹å®šæ•…éšœã€‚</p>
<h3 is-upgraded>2.1 æ¸¬è©¦å–®ä¸€æœå‹™çš„éŸŒæ€§</h3>
<pre><code language="language-bash" class="language-bash"># çµ¦ Service B æ·»åŠ  30% ä¸ŸåŒ…ç‡
make chaos-loss-service-b
</code></pre>
<p><strong>å¯¦é©—æ­¥é©Ÿ</strong>ï¼š</p>
<ol type="1">
<li>å•Ÿå‹•æ··æ²Œæ¸¬è©¦</li>
<li>é‹è¡Œ K6: <code>k6 run k6/load-test.js</code></li>
<li>åœ¨ Grafana ä¸­æŸ¥çœ‹ï¼š <ul>
<li>Service A æ˜¯å¦èƒ½æ­£å¸¸è™•ç† Service B çš„æ•…éšœï¼Ÿ</li>
<li>éŒ¯èª¤æ˜¯å¦è¢«æ­£ç¢ºè¨˜éŒ„ï¼Ÿ</li>
<li>Trace ä¸­æ˜¯å¦é¡¯ç¤ºå¤±æ•—çš„ Spanï¼Ÿ</li>
</ul>
</li>
</ol>
<h3 is-upgraded>2.2 è³‡æ–™åº«æ··æ²Œæ¸¬è©¦</h3>
<pre><code language="language-bash" class="language-bash"># å° PostgreSQL é€²è¡Œå£“åŠ›æ¸¬è©¦
make chaos-stress-postgres
</code></pre>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>è³‡æ–™åº«æŸ¥è©¢å»¶é²</li>
<li>é€£æ¥æ± æ˜¯å¦è€—ç›¡</li>
<li>æ‡‰ç”¨æ˜¯å¦æœ‰å¿«å–æ©Ÿåˆ¶ä¾†æ¸›è¼•å½±éŸ¿</li>
</ul>
<h3 is-upgraded>2.3 æ¶ˆæ¯ä½‡åˆ—æ··æ²Œ</h3>
<pre><code language="language-bash" class="language-bash"># æš«åœ Kafka å®¹å™¨ 30 ç§’
make chaos-pause-kafka
</code></pre>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>Service B å’Œ Service C å¦‚ä½•è™•ç†æ¶ˆæ¯ç™¼é€å¤±æ•—</li>
<li>æ¶ˆæ¯æ˜¯å¦æœƒä¸Ÿå¤±</li>
<li>æ¢å¾©å¾Œæ˜¯å¦èƒ½æ­£å¸¸æ¶ˆè²»</li>
</ul>
<h2 is-upgraded>Level 3ï¼šå®¹å™¨ç”Ÿå‘½é€±æœŸæ··æ²Œ â­â­â­</h2>
<p>æ¸¬è©¦æœå‹™åœ¨çªç„¶çµ‚æ­¢å’Œé‡å•Ÿæ™‚çš„è¡Œç‚ºã€‚</p>
<h3 is-upgraded>3.1 éš¨æ©Ÿæ®ºæ­»æœå‹™</h3>
<pre><code language="language-bash" class="language-bash"># æ¯ 30 ç§’éš¨æ©Ÿæ®ºæ­»ä¸€å€‹æ‡‰ç”¨æœå‹™
make chaos-kill-random
</code></pre>
<p><strong>é€™å€‹æ¸¬è©¦æœƒ</strong>ï¼š</p>
<ul>
<li>éš¨æ©Ÿé¸æ“‡ä¸€å€‹æœå‹™ï¼ˆapi-gateway æˆ– service-a/b/c/dï¼‰</li>
<li>ç™¼é€ SIGKILL ä¿¡è™Ÿçµ‚æ­¢å®¹å™¨</li>
<li>Docker Compose æœƒè‡ªå‹•é‡å•Ÿå®¹å™¨</li>
</ul>
<p><strong>å¯¦é©—æ­¥é©Ÿ</strong>ï¼š</p>
<ol type="1">
<li>å•Ÿå‹•æ··æ²Œæ¸¬è©¦</li>
<li>åœ¨å¦ä¸€å€‹çµ‚ç«¯æŒçºŒé‹è¡Œ K6</li>
<li>è§€å¯Ÿ Grafana ä¸­çš„ï¼š<ul>
<li>éŒ¯èª¤ç‡è®ŠåŒ–</li>
<li>æœå‹™é‡å•Ÿçš„ Trace ç¼ºå£</li>
<li>Metrics çš„æ–·é»</li>
</ul>
</li>
<li>é‹è¡Œ 2-3 åˆ†é˜å¾Œåœæ­¢ï¼š<pre><code language="language-bash" class="language-bash">make chaos-stop
</code></pre>
</li>
</ol>
<h3 is-upgraded>3.2 æ®ºæ­» API Gateway</h3>
<pre><code language="language-bash" class="language-bash"># ä¸€æ¬¡æ€§æ®ºæ­» API Gateway
make chaos-kill-gateway
</code></pre>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>é‡å•Ÿéœ€è¦å¤šä¹…ï¼Ÿ</li>
<li>æœŸé–“æœ‰å¤šå°‘è«‹æ±‚å¤±æ•—ï¼Ÿ</li>
<li>è² è¼‰å‡è¡¡å™¨ï¼ˆå¦‚æœæœ‰ï¼‰å¦‚ä½•è™•ç†ï¼Ÿ</li>
</ul>
<p>Negative : <strong>æ³¨æ„</strong>ï¼š<code>chaos-kill-random</code> æœƒæŒçºŒé‹è¡Œï¼Œè¨˜å¾—åœ¨å¯¦é©—çµæŸå¾ŒåŸ·è¡Œ <code>make chaos-stop</code> åœæ­¢ï¼</p>
<h2 is-upgraded>Level 4ï¼šè¤‡é›œçœŸå¯¦å ´æ™¯ â­â­â­â­</h2>
<p>æ¨¡æ“¬å¤šå€‹æ•…éšœåŒæ™‚ç™¼ç”Ÿçš„è¤‡é›œæƒ…æ³ã€‚</p>
<h3 is-upgraded>4.1 å¾®æœå‹™éˆè·¯æ•…éšœ</h3>
<p>é€™å€‹å ´æ™¯æ¨¡æ“¬å¤šå€‹æœå‹™åŒæ™‚å‡ºç¾ä¸åŒå•é¡Œï¼š</p>
<pre><code language="language-bash" class="language-bash"># å•Ÿå‹•è¤‡é›œå ´æ™¯
make chaos-microservice-chain
</code></pre>
<p><strong>é€™å€‹å‘½ä»¤æœƒåŒæ™‚</strong>ï¼š</p>
<ul>
<li>Service Aï¼šç¶²è·¯å»¶é² 800ms</li>
<li>Service Bï¼š15% ä¸ŸåŒ…</li>
<li>Service Cï¼šCPU å£“åŠ›</li>
</ul>
<p><strong>å¯¦é©—æ­¥é©Ÿ</strong>ï¼š</p>
<ol type="1">
<li><strong>å•Ÿå‹•æ··æ²Œæ¸¬è©¦</strong></li>
<li><strong>æŒçºŒç”Ÿæˆæµé‡</strong>ï¼š<pre><code language="language-bash" class="language-bash">k6 run k6/load-test.js
</code></pre>
</li>
<li><strong>åœ¨ Grafana ä¸­è§€å¯Ÿéˆè·¯</strong>ï¼š<ul>
<li>æ‰“é–‹ Tempoï¼ˆTracesï¼‰</li>
<li>æŸ¥æ‰¾å®Œæ•´çš„è«‹æ±‚éˆè·¯</li>
<li>è§€å¯Ÿå“ªå€‹æœå‹™æˆç‚ºç“¶é ¸</li>
</ul>
</li>
<li><strong>åˆ†æ Metrics</strong>ï¼š<pre><code language="language-promql" class="language-promql"># å„æœå‹™çš„éŒ¯èª¤ç‡
rate(http_server_requests_total{status_code=~&#34;5..&#34;}[1m])

# å„æœå‹™çš„å»¶é²
histogram_quantile(0.95,
  rate(http_server_duration_milliseconds_bucket[1m]))
</code></pre>
</li>
<li><strong>æŸ¥çœ‹ Logs</strong>ï¼š<ul>
<li>åœ¨ Grafana Loki ä¸­æœå°‹éŒ¯èª¤</li>
<li>é»æ“Š Trace ID é—œè¯æŸ¥çœ‹</li>
</ul>
</li>
<li><strong>5 åˆ†é˜å¾Œåœæ­¢</strong>ï¼š<pre><code language="language-bash" class="language-bash">make chaos-stop
</code></pre>
</li>
</ol>
<h3 is-upgraded>4.2 è³‡æ–™åº«ä¸­æ–·å ´æ™¯</h3>
<pre><code language="language-bash" class="language-bash"># æ¨¡æ“¬è³‡æ–™åº«ä¸­æ–·ï¼ˆ2000ms å»¶é²ï¼‰
make chaos-database-outage
</code></pre>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>Service A çš„è³‡æ–™åº«æŸ¥è©¢è¶…æ™‚</li>
<li>é€£æ¥æ± æ˜¯å¦è€—ç›¡</li>
<li>æ‡‰ç”¨å¦‚ä½•è™•ç†è³‡æ–™åº«æ…¢æŸ¥è©¢</li>
</ul>
<h3 is-upgraded>4.3 ç¶²è·¯åˆ†å€</h3>
<pre><code language="language-bash" class="language-bash"># æ¨¡æ“¬ Service A å’Œ Service B ä¹‹é–“ç¶²è·¯åˆ†å€
make chaos-network-partition
</code></pre>
<p><strong>é€™å€‹æ¸¬è©¦æœƒ</strong>ï¼š</p>
<ul>
<li>Service A å’Œ Service B å„æœ‰ 90% ä¸ŸåŒ…</li>
<li>æ¨¡æ“¬å…©å€‹æœå‹™å¹¾ä¹ç„¡æ³•é€šè¨Š</li>
</ul>
<p><strong>è§€å¯Ÿé‡é»</strong>ï¼š</p>
<ul>
<li>ç³»çµ±å¦‚ä½•é™ç´š</li>
<li>æ˜¯å¦æœ‰ Circuit Breaker è§¸ç™¼</li>
<li>éŒ¯èª¤è™•ç†å’Œ Fallback æ©Ÿåˆ¶</li>
</ul>
<h2 is-upgraded>Level 5ï¼šè‡ªè¨‚æ··æ²Œæ¸¬è©¦ â­â­â­â­â­</h2>
<p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Pumba Docker å‘½ä»¤é€²è¡Œæ›´éˆæ´»çš„æ¸¬è©¦ï¼š</p>
<pre><code language="language-bash" class="language-bash"># å°ç‰¹å®šæœå‹™æ·»åŠ è¤‡é›œç¶²è·¯æ¢ä»¶
docker run -d --name my-chaos-test \
  -v /var/run/docker.sock:/var/run/docker.sock \
  gaiaadm/pumba:latest \
  netem --duration 3m \
  --tc-image ghcr.io/alexei-led/pumba-alpine-nettools:latest \
  delay --time 1000 --jitter 300 --distribution normal \
  service-a
</code></pre>
<p><strong>è‡ªè¨‚åƒæ•¸</strong>ï¼š</p>
<ul>
<li><code>--time</code>: å»¶é²æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰</li>
<li><code>--jitter</code>: æŠ–å‹•ç¯„åœ</li>
<li><code>--distribution</code>: åˆ†ä½ˆé¡å‹ï¼ˆnormal, pareto, paretonormalï¼‰</li>
<li><code>--correlation</code>: ç›¸é—œæ€§ç™¾åˆ†æ¯”</li>
</ul>
<h2 is-upgraded>æ··æ²Œæ¸¬è©¦æœ€ä½³å¯¦è¸</h2>
<p>Positive : <strong>å¾ªåºæ¼¸é€²</strong> : 1. å…ˆå¾å–®ä¸€ã€ç°¡å–®çš„æ•…éšœé–‹å§‹ : 2. é€æ­¥å¢åŠ è¤‡é›œåº¦ : 3. åœ¨ç”Ÿç”¢ç’°å¢ƒå‰å…ˆåœ¨æ¸¬è©¦ç’°å¢ƒé©—è­‰ : 4. å»ºç«‹å›æ»¾è¨ˆç•«</p>
<p>Positive : <strong>è§€å¯Ÿèˆ‡åˆ†æ</strong> : 1. ä½¿ç”¨ Grafana çš„ä¸‰å¤§æ”¯æŸ±ï¼ˆLogsã€Metricsã€Tracesï¼‰ : 2. è¨˜éŒ„æ¯æ¬¡å¯¦é©—çš„ç™¼ç¾ : 3. é©—è­‰å‘Šè­¦æ˜¯å¦æ­£å¸¸è§¸ç™¼ : 4. æ¸¬é‡æ¢å¾©æ™‚é–“ï¼ˆMTTRï¼‰</p>
<p>Positive : <strong>å®‰å…¨ç¬¬ä¸€</strong> : 1. æ°¸é å…ˆåœ¨éç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦ : 2. è¨­å®šæ˜ç¢ºçš„æ¸¬è©¦æ™‚é–“çª—å£ : 3. ç¢ºä¿å¯ä»¥å¿«é€Ÿåœæ­¢æ¸¬è©¦ : 4. é€šçŸ¥åœ˜éšŠæˆå“¡æ­£åœ¨é€²è¡Œæ··æ²Œæ¸¬è©¦</p>
<h2 is-upgraded>æ··æ²Œæ¸¬è©¦ Checklist</h2>
<p>å¯¦é©—å‰ï¼š</p>
<ul>
<li>[ ] ç¢ºèªæ‰€æœ‰æœå‹™æ­£å¸¸é‹è¡Œ (<code>make status</code>)</li>
<li>[ ] Grafana å¯ä»¥æ­£å¸¸å­˜å–</li>
<li>[ ] K6 å·²å®‰è£ä¸¦å¯ä»¥é‹è¡Œ</li>
<li>[ ] äº†è§£å¦‚ä½•åœæ­¢æ¸¬è©¦ (<code>make chaos-stop</code>)</li>
</ul>
<p>å¯¦é©—ä¸­ï¼š</p>
<ul>
<li>[ ] åœ¨ Grafana ä¸­å³æ™‚è§€å¯Ÿ</li>
<li>[ ] è¨˜éŒ„è§€å¯Ÿåˆ°çš„ç¾è±¡</li>
<li>[ ] æˆªåœ–ä¿å­˜é‡è¦ç™¼ç¾</li>
</ul>
<p>å¯¦é©—å¾Œï¼š</p>
<ul>
<li>[ ] åœæ­¢æ‰€æœ‰æ··æ²Œæ¸¬è©¦ (<code>make chaos-stop</code>)</li>
<li>[ ] æ¸…ç† Pumba å®¹å™¨ (<code>make chaos-clean</code>)</li>
<li>[ ] é©—è­‰æœå‹™æ¢å¾©æ­£å¸¸</li>
<li>[ ] ç¸½çµå­¸ç¿’é‡é»</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Python Auto Instrumentation è©³è§£" duration="15">
        <h2 is-upgraded>ä»€éº¼æ˜¯è‡ªå‹•åŸ‹é»ï¼Ÿ</h2>
<p>è‡ªå‹•åŸ‹é»ï¼ˆAuto Instrumentationï¼‰æ˜¯æŒ‡<strong>ç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼</strong>ï¼Œé€é OpenTelemetry Agent æˆ– SDK è‡ªå‹•æ•ç²é™æ¸¬è³‡æ–™ã€‚</p>
<h2 is-upgraded>Service-A çš„è‡ªå‹•åŸ‹é»é…ç½®</h2>
<p>æŸ¥çœ‹ Service-A çš„ Dockerfileï¼š</p>
<pre><code language="language-bash" class="language-bash">cat services/service-a/Dockerfile
</code></pre>
<p>ä½ æœƒçœ‹åˆ°é¡ä¼¼é€™æ¨£çš„é…ç½®ï¼š</p>
<pre><code language="language-dockerfile" class="language-dockerfile">FROM python:3.11-slim

# å®‰è£ç›¸ä¾å¥—ä»¶
COPY requirements.txt .
RUN pip install -r requirements.txt

# å®‰è£ OpenTelemetry è‡ªå‹•åŸ‹é»å¥—ä»¶
RUN pip install opentelemetry-distro \
                opentelemetry-exporter-otlp

# è‡ªå‹•æª¢æ¸¬ä¸¦å®‰è£ç›¸é—œå‡½å¼åº«çš„åŸ‹é»
RUN opentelemetry-bootstrap -a install

COPY . /app
WORKDIR /app

# ä½¿ç”¨ opentelemetry-instrument å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
CMD [&#34;opentelemetry-instrument&#34;, &#34;uvicorn&#34;, &#34;main:app&#34;, &#34;--host&#34;, &#34;0.0.0.0&#34;, &#34;--port&#34;, &#34;8001&#34;]
</code></pre>
<h2 is-upgraded>é—œéµå…ƒä»¶èªªæ˜</h2>
<h3 is-upgraded>1. <code>opentelemetry-distro</code></h3>
<p>OpenTelemetry çš„å®Œæ•´ç™¼è¡Œç‰ˆï¼ŒåŒ…å«æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<h3 is-upgraded>2. <code>opentelemetry-bootstrap</code></h3>
<p>è‡ªå‹•æª¢æ¸¬æ‡‰ç”¨ç¨‹å¼ç›¸ä¾çš„å‡½å¼åº«ï¼Œä¸¦å®‰è£å°æ‡‰çš„åŸ‹é»å¥—ä»¶ï¼š</p>
<ul>
<li>FastAPI â†’ <code>opentelemetry-instrumentation-fastapi</code></li>
<li>Requests â†’ <code>opentelemetry-instrumentation-requests</code></li>
<li>SQLAlchemy â†’ <code>opentelemetry-instrumentation-sqlalchemy</code></li>
</ul>
<h3 is-upgraded>3. <code>opentelemetry-instrument</code></h3>
<p>å•Ÿå‹•æ™‚çš„åŒ…è£å™¨ï¼Œè‡ªå‹•å•Ÿç”¨æ‰€æœ‰åŸ‹é»ã€‚</p>
<h2 is-upgraded>ç’°å¢ƒè®Šæ•¸é…ç½®</h2>
<p>åœ¨ <code>docker-compose.yaml</code> ä¸­ï¼ŒService-A é…ç½®äº†ä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ï¼š</p>
<pre><code language="language-yaml" class="language-yaml">environment:
  OTEL_SERVICE_NAME: service-a
  OTEL_TRACES_EXPORTER: otlp
  OTEL_METRICS_EXPORTER: otlp
  OTEL_LOGS_EXPORTER: otlp
  OTEL_EXPORTER_OTLP_ENDPOINT: http://otel-collector:4317
  OTEL_EXPORTER_OTLP_PROTOCOL: grpc
  OTEL_RESOURCE_ATTRIBUTES: service.name=service-a,service.version=1.0.0
</code></pre>
<h2 is-upgraded>æŸ¥çœ‹è‡ªå‹•ç”Ÿæˆçš„ Traces</h2>
<ol type="1">
<li>è§¸ç™¼ä¸€å€‹è«‹æ±‚:<pre><code language="language-bash" class="language-bash">curl http://localhost:8080/api/process
</code></pre>
</li>
<li>åœ¨ Grafana ä¸­:<ul>
<li>é–‹å•Ÿ <strong>Explore</strong></li>
<li>é¸æ“‡è³‡æ–™ä¾†æº: <strong>Tempo</strong></li>
<li>é¸æ“‡ <strong>Service</strong>: <code>service-a</code></li>
<li>é»æ“Š <strong>Run query</strong></li>
</ul>
</li>
<li>é»æ“Šä»»æ„ traceï¼Œä½ æœƒçœ‹åˆ°è‡ªå‹•ç”Ÿæˆçš„ spans:<ul>
<li>HTTP è«‹æ±‚ span</li>
<li>è³‡æ–™åº«æŸ¥è©¢ span</li>
<li>ä¸‹æ¸¸æœå‹™å‘¼å« span</li>
</ul>
</li>
</ol>
<p class="image-container"><img alt="Auto Instrumentation Trace" src="img/0.png"></p>
<h2 is-upgraded>è‡ªå‹•åŸ‹é»çš„å„ªå‹¢</h2>
<p>âœ… <strong>é›¶ç¨‹å¼ç¢¼ä¾µå…¥</strong>: ä¸éœ€è¦ä¿®æ”¹æ¥­å‹™ç¨‹å¼ç¢¼ âœ… <strong>å¿«é€Ÿå•Ÿç”¨</strong>: å¹¾åˆ†é˜å…§å®Œæˆé…ç½® âœ… <strong>è¦†è“‹å»£æ³›</strong>: è‡ªå‹•æ”¯æ´å¸¸è¦‹æ¡†æ¶å’Œå‡½å¼åº« âœ… <strong>æ¨™æº–åŒ–</strong>: éµå¾ª OpenTelemetry è¦ç¯„</p>
<h2 is-upgraded>è‡ªå‹•åŸ‹é»çš„å±€é™</h2>
<p>âŒ <strong>ç¼ºä¹æ¥­å‹™æƒ…å¢ƒ</strong>: ç„¡æ³•æ•ç²æ¥­å‹™ç‰¹å®šçš„æŒ‡æ¨™ âŒ <strong>ç²¾ç´°åº¦æœ‰é™</strong>: ç„¡æ³•è‡ªè¨‚ span å±¬æ€§ âŒ <strong>æ•ˆèƒ½é–‹éŠ·</strong>: å¯èƒ½æ•ç²ä¸å¿…è¦çš„è³‡è¨Š</p>
<p>Positive : è‡ªå‹•åŸ‹é»é©åˆå¿«é€Ÿé–‹å§‹å’Œé€šç”¨å ´æ™¯ï¼Œä½†è¤‡é›œæ¥­å‹™éœ€è¦æ‰‹å‹•åŸ‹é»ï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="Python Manual Instrumentation è©³è§£" duration="15">
        <h2 is-upgraded>ç‚ºä»€éº¼éœ€è¦æ‰‹å‹•åŸ‹é»ï¼Ÿ</h2>
<p>æ‰‹å‹•åŸ‹é»å…è¨±ä½ ï¼š</p>
<ul>
<li>æ–°å¢æ¥­å‹™ç‰¹å®šçš„ metrics å’Œ traces</li>
<li>è‡ªè¨‚ span å±¬æ€§å’Œäº‹ä»¶</li>
<li>æœ€ä½³åŒ–æ•ˆèƒ½ï¼ˆåªè¨˜éŒ„éœ€è¦çš„è³‡æ–™ï¼‰</li>
<li>æ–°å¢æ¥­å‹™èªç¾©</li>
</ul>
<h2 is-upgraded>Service-D çš„æ‰‹å‹•åŸ‹é»ç¯„ä¾‹</h2>
<p>æŸ¥çœ‹ Service-D çš„ç¨‹å¼ç¢¼ï¼š</p>
<pre><code language="language-bash" class="language-bash">cat services/service-d/app.py
</code></pre>
<h3 is-upgraded>1. åˆå§‹åŒ– OpenTelemetry</h3>
<pre><code language="language-python" class="language-python">from opentelemetry import trace, metrics
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor
from opentelemetry.exporter.otlp.proto.grpc.trace_exporter import OTLPSpanExporter
from opentelemetry.sdk.resources import Resource
from opentelemetry.sdk.metrics import MeterProvider
from opentelemetry.sdk.metrics.export import PeriodicExportingMetricReader
from opentelemetry.exporter.otlp.proto.grpc.metric_exporter import OTLPMetricExporter

# å®šç¾©æœå‹™è³‡æº
resource = Resource.create({
    &#34;service.name&#34;: &#34;service-d&#34;,
    &#34;service.version&#34;: &#34;1.0.0&#34;,
    &#34;deployment.environment&#34;: &#34;production&#34;
})

# é…ç½® Trace Provider
trace_provider = TracerProvider(resource=resource)
span_processor = BatchSpanProcessor(
    OTLPSpanExporter(endpoint=&#34;http://otel-collector:4317&#34;)
)
trace_provider.add_span_processor(span_processor)
trace.set_tracer_provider(trace_provider)

# é…ç½® Metrics Provider
metric_reader = PeriodicExportingMetricReader(
    OTLPMetricExporter(endpoint=&#34;http://otel-collector:4317&#34;)
)
meter_provider = MeterProvider(
    resource=resource,
    metric_readers=[metric_reader]
)
metrics.set_meter_provider(meter_provider)

# å–å¾— tracer å’Œ meter
tracer = trace.get_tracer(__name__)
meter = metrics.get_meter(__name__)
</code></pre>
<h3 is-upgraded>2. å»ºç«‹è‡ªè¨‚ Span</h3>
<pre><code language="language-python" class="language-python">from flask import Flask, request
from opentelemetry import trace

app = Flask(__name__)
tracer = trace.get_tracer(__name__)

@app.route(&#39;/process&#39;)
def process():
    # å»ºç«‹ä¸€å€‹è‡ªè¨‚ span
    with tracer.start_as_current_span(&#34;business_logic&#34;) as span:
        # æ–°å¢è‡ªè¨‚å±¬æ€§
        span.set_attribute(&#34;user.id&#34;, request.headers.get(&#34;X-User-ID&#34;, &#34;anonymous&#34;))
        span.set_attribute(&#34;request.size&#34;, len(request.data))

        # æ–°å¢äº‹ä»¶
        span.add_event(&#34;Processing started&#34;, {
            &#34;items&#34;: 10,
            &#34;priority&#34;: &#34;high&#34;
        })

        # æ¥­å‹™é‚è¼¯
        result = do_business_logic()

        # æ–°å¢çµæœå±¬æ€§
        span.set_attribute(&#34;result.count&#34;, len(result))

        return result
</code></pre>
<h3 is-upgraded>3. å»ºç«‹è‡ªè¨‚ Metrics</h3>
<pre><code language="language-python" class="language-python">from opentelemetry import metrics

meter = metrics.get_meter(__name__)

# å»ºç«‹è¨ˆæ•¸å™¨
request_counter = meter.create_counter(
    name=&#34;business.requests.total&#34;,
    description=&#34;Total number of business requests&#34;,
    unit=&#34;1&#34;
)

# å»ºç«‹ç›´æ–¹åœ–
processing_time = meter.create_histogram(
    name=&#34;business.processing.duration&#34;,
    description=&#34;Processing duration in milliseconds&#34;,
    unit=&#34;ms&#34;
)

# ä½¿ç”¨ metrics
@app.route(&#39;/process&#39;)
def process():
    start_time = time.time()

    # å¢åŠ è¨ˆæ•¸å™¨
    request_counter.add(1, {&#34;endpoint&#34;: &#34;/process&#34;, &#34;method&#34;: &#34;GET&#34;})

    # è™•ç†è«‹æ±‚
    result = do_work()

    # è¨˜éŒ„è™•ç†æ™‚é–“
    duration = (time.time() - start_time) * 1000
    processing_time.record(duration, {&#34;status&#34;: &#34;success&#34;})

    return result
</code></pre>
<h3 is-upgraded>4. çµæ§‹åŒ–æ—¥èªŒèˆ‡ Trace é—œè¯</h3>
<pre><code language="language-python" class="language-python">import logging
from opentelemetry import trace

# é…ç½® JSON æ—¥èªŒ
import json_log_formatter

formatter = json_log_formatter.JSONFormatter()
json_handler = logging.StreamHandler()
json_handler.setFormatter(formatter)

logger = logging.getLogger(__name__)
logger.addHandler(json_handler)
logger.setLevel(logging.INFO)

@app.route(&#39;/process&#39;)
def process():
    # å–å¾—ç›®å‰ span context
    span = trace.get_current_span()
    trace_id = format(span.get_span_context().trace_id, &#39;032x&#39;)
    span_id = format(span.get_span_context().span_id, &#39;016x&#39;)

    # è¨˜éŒ„åŒ…å« trace è³‡è¨Šçš„æ—¥èªŒ
    logger.info(&#34;Processing request&#34;, extra={
        &#34;trace_id&#34;: trace_id,
        &#34;span_id&#34;: span_id,
        &#34;user_id&#34;: request.headers.get(&#34;X-User-ID&#34;),
        &#34;endpoint&#34;: &#34;/process&#34;
    })

    return result
</code></pre>
<h2 is-upgraded>åœ¨ Grafana ä¸­æŸ¥çœ‹æ‰‹å‹•åŸ‹é»è³‡æ–™</h2>
<h3 is-upgraded>æŸ¥çœ‹è‡ªè¨‚ Span</h3>
<ol type="1">
<li>Grafana â†’ Explore â†’ Tempo</li>
<li>æœå°‹ service-d çš„ traces</li>
<li>ä½ æœƒçœ‹åˆ°è‡ªè¨‚çš„ <code>business_logic</code> span</li>
<li>é»æ“ŠæŸ¥çœ‹è©³ç´°å±¬æ€§: <ul>
<li><code>user.id</code></li>
<li><code>request.size</code></li>
<li><code>result.count</code></li>
</ul>
</li>
</ol>
<h3 is-upgraded>æŸ¥çœ‹è‡ªè¨‚ Metrics</h3>
<ol type="1">
<li>Grafana â†’ Explore â†’ Prometheus</li>
<li>æŸ¥è©¢: <pre><code language="language-promql" class="language-promql">rate(business_requests_total[1m])
</code></pre>
</li>
<li>æˆ–è€…: <pre><code language="language-promql" class="language-promql">histogram_quantile(0.95,
  rate(business_processing_duration_bucket[1m])
)
</code></pre>
</li>
</ol>
<h3 is-upgraded>é—œè¯æ—¥èªŒ</h3>
<ol type="1">
<li>Grafana â†’ Explore â†’ Loki</li>
<li>æŸ¥è©¢: <pre><code language="language-logql" class="language-logql">{service_name=&#34;service-d&#34;} | json
</code></pre>
</li>
<li>é»æ“Šä»»æ„æ—¥èªŒè¡Œçš„ trace_idï¼Œç›´æ¥è·³è½‰åˆ°å°æ‡‰çš„ trace</li>
</ol>
<p class="image-container"><img alt="Manual Instrumentation" src="img/0.png"></p>
<h2 is-upgraded>æ‰‹å‹•åŸ‹é»æœ€ä½³å¯¦è¸</h2>
<ol type="1">
<li><strong>æœ‰æ„ç¾©çš„ Span åç¨±</strong>: ä½¿ç”¨æ¥­å‹™è¡“èªï¼Œå¦‚ <code>checkout_cart</code> è€Œä¸æ˜¯ <code>process</code></li>
<li><strong>æ–°å¢æƒ…å¢ƒå±¬æ€§</strong>: ä½¿ç”¨è€…IDã€è¨‚å–®IDã€ç”¢å“é¡å‹ç­‰</li>
<li><strong>è¨˜éŒ„é—œéµäº‹ä»¶</strong>: æ”¯ä»˜é–‹å§‹ã€åº«å­˜æª¢æŸ¥ã€ç¬¬ä¸‰æ–¹å‘¼å«ç­‰</li>
<li><strong>æ§åˆ¶åŸºæ•¸</strong>: é¿å…é«˜åŸºæ•¸å±¬æ€§ï¼ˆå¦‚æ™‚é–“æˆ³è¨˜ã€UUIDï¼‰ä½œç‚º metric æ¨™ç±¤</li>
<li><strong>æ•ˆèƒ½è€ƒé‡</strong>: ä½¿ç”¨æ¡æ¨£ã€é¿å…åœ¨ç†±è·¯å¾‘å»ºç«‹éå¤š span</li>
</ol>
<p>Positive : æ‰‹å‹•åŸ‹é»çµ¦ä½ å®Œå…¨æ§åˆ¶æ¬Šï¼Œä½†éœ€è¦æ›´å¤šç¨‹å¼ç¢¼å’Œç¶­è­·å·¥ä½œï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="æ··åˆä½¿ç”¨ Auto å’Œ Manual Instrumentation" duration="10">
        <h2 is-upgraded>æœ€ä½³å¯¦è¸ï¼šçµåˆå…©è€…</h2>
<p>åœ¨å¯¦éš›å°ˆæ¡ˆä¸­ï¼Œé€šå¸¸æœƒ<strong>æ··åˆä½¿ç”¨</strong>è‡ªå‹•åŸ‹é»å’Œæ‰‹å‹•åŸ‹é»ï¼š</p>
<pre><code language="language-python" class="language-python"># app.py
from opentelemetry.instrumentation.fastapi import FastAPIInstrumentor
from opentelemetry import trace
from fastapi import FastAPI

app = FastAPI()

# 1. å•Ÿç”¨è‡ªå‹•åŸ‹é»ï¼ˆæ¡†æ¶å±¤ç´šï¼‰
FastAPIInstrumentor.instrument_app(app)

# 2. å–å¾— tracer ç”¨æ–¼æ‰‹å‹•åŸ‹é»ï¼ˆæ¥­å‹™å±¤ç´šï¼‰
tracer = trace.get_tracer(__name__)

@app.get(&#34;/checkout&#34;)
async def checkout(cart_id: str):
    # è‡ªå‹•åŸ‹é»å·²ç¶“å»ºç«‹äº† HTTP span

    # æ–°å¢æ¥­å‹™å±¤ç´šçš„ span
    with tracer.start_as_current_span(&#34;validate_cart&#34;) as span:
        span.set_attribute(&#34;cart.id&#34;, cart_id)
        cart = await validate_cart(cart_id)

    with tracer.start_as_current_span(&#34;calculate_total&#34;) as span:
        total = calculate_total(cart)
        span.set_attribute(&#34;cart.total&#34;, total)

    with tracer.start_as_current_span(&#34;process_payment&#34;) as span:
        span.set_attribute(&#34;payment.method&#34;, &#34;credit_card&#34;)
        result = await process_payment(total)

    return result
</code></pre>
<h2 is-upgraded>åœ¨ Grafana ä¸­æŸ¥çœ‹æ··åˆåŸ‹é»</h2>
<p>ç”Ÿæˆçš„ trace æœƒé¡¯ç¤ºï¼š</p>
<pre><code>HTTP POST /checkout (auto)              [200ms]
â”œâ”€ validate_cart (manual)               [50ms]
â”‚  â””â”€ SELECT FROM carts (auto)          [20ms]
â”œâ”€ calculate_total (manual)             [30ms]
â””â”€ process_payment (manual)             [120ms]
   â””â”€ HTTP POST /api/charge (auto)      [100ms]
</code></pre>
<h2 is-upgraded>æ±ºç­–æ¨¹ï¼šä½•æ™‚ä½¿ç”¨å“ªç¨®æ–¹å¼ï¼Ÿ</h2>
<pre><code>æ˜¯å¦æ˜¯æ¨™æº–æ¡†æ¶/å‡½å¼åº«ï¼ˆHTTPã€DBã€è¨Šæ¯ä½‡åˆ—ï¼‰ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ä½¿ç”¨è‡ªå‹•åŸ‹é»
â””â”€ å¦ â†’ æ˜¯å¦æ˜¯æ¥­å‹™æ ¸å¿ƒé‚è¼¯ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨æ‰‹å‹•åŸ‹é»
   â””â”€ å¦ â†’ å¯èƒ½ä¸éœ€è¦åŸ‹é»
</code></pre>
<p>Positive : è‡ªå‹•åŸ‹é»æ‰“åŸºç¤ï¼Œæ‰‹å‹•åŸ‹é»åŠ æ·±åº¦ï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="Grafana é€²éšåŠŸèƒ½ï¼šé—œè¯ Logs-Traces-Metrics" duration="12">
        <h2 is-upgraded>Trace to Logs</h2>
<p>åœ¨æŸ¥çœ‹ trace æ™‚ï¼Œç›´æ¥è·³è½‰åˆ°ç›¸é—œæ—¥èªŒï¼š</p>
<ol type="1">
<li>åœ¨ Tempo ä¸­é–‹å•Ÿä¸€å€‹ trace</li>
<li>é»æ“Šä»»æ„ span</li>
<li>åœ¨å³å´é¢æ¿æ‰¾åˆ° <strong>Logs for this span</strong></li>
<li>é»æ“Šå¾Œè‡ªå‹•è·³è½‰åˆ° Lokiï¼Œé¡¯ç¤ºè©² span çš„æ—¥èªŒ</li>
</ol>
<h2 is-upgraded>Logs to Traces</h2>
<p>å¾æ—¥èªŒè·³è½‰åˆ° traceï¼š</p>
<ol type="1">
<li>åœ¨ Loki ä¸­æŸ¥è©¢: <pre><code language="language-logql" class="language-logql">{service_name=&#34;service-a&#34;} | json
</code></pre>
</li>
<li>åœ¨æ—¥èªŒè¡Œä¸­æ‰¾åˆ° <code>trace_id</code> æ¬„ä½</li>
<li>é»æ“Š trace_id æ—çš„åœ–ç¤ºï¼Œè·³è½‰åˆ° Tempo</li>
</ol>
<h2 is-upgraded>Metrics to Traces</h2>
<p>å¾ metrics å‘Šè­¦å®šä½åˆ°å…·é«”è«‹æ±‚ï¼š</p>
<ol type="1">
<li>åœ¨ Prometheus ä¸­ç™¼ç¾ç•°å¸¸: <pre><code language="language-promql" class="language-promql">rate(http_requests_total{status=&#34;500&#34;}[1m]) &gt; 0
</code></pre>
</li>
<li>è¨˜ä¸‹æ™‚é–“ç¯„åœå’Œæœå‹™åç¨±</li>
<li>åœ¨ Tempo ä¸­æŒ‰æ™‚é–“å’Œæœå‹™æœå°‹ traces</li>
<li>æ‰¾åˆ°å¤±æ•—çš„è«‹æ±‚ï¼ŒæŸ¥çœ‹è©³ç´°è³‡è¨Š</li>
</ol>
<h2 is-upgraded>å»ºç«‹é—œè¯ Dashboard</h2>
<p>å»ºç«‹ä¸€å€‹åŒ…å«ä¸‰è€…çš„ dashboardï¼š</p>
<pre><code language="language-json" class="language-json">{
  &#34;dashboard&#34;: {
    &#34;title&#34;: &#34;Service Overview&#34;,
    &#34;panels&#34;: [
      {
        &#34;title&#34;: &#34;Request Rate&#34;,
        &#34;type&#34;: &#34;graph&#34;,
        &#34;datasource&#34;: &#34;Prometheus&#34;,
        &#34;targets&#34;: [
          {
            &#34;expr&#34;: &#34;rate(http_requests_total[5m])&#34;
          }
        ]
      },
      {
        &#34;title&#34;: &#34;Recent Traces&#34;,
        &#34;type&#34;: &#34;traces&#34;,
        &#34;datasource&#34;: &#34;Tempo&#34;
      },
      {
        &#34;title&#34;: &#34;Error Logs&#34;,
        &#34;type&#34;: &#34;logs&#34;,
        &#34;datasource&#34;: &#34;Loki&#34;,
        &#34;targets&#34;: [
          {
            &#34;expr&#34;: &#34;{service_name=\&#34;service-a\&#34;} |= \&#34;ERROR\&#34;&#34;
          }
        ]
      }
    ]
  }
}
</code></pre>
<p class="image-container"><img alt="Correlated Dashboard" src="img/0.png"></p>
<p>Positive : ä¸‰å¤§æ”¯æŸ±çš„é—œè¯æ˜¯å¯è§€æ¸¬æ€§çš„ç²¾é«“ï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="å¯¦æˆ°æ¼”ç·´ï¼šå®Œæ•´é™¤éŒ¯æµç¨‹" duration="15">
        <p>è®“æˆ‘å€‘é€éä¸€å€‹å®Œæ•´çš„å ´æ™¯ä¾†æ¼”ç·´ï¼š</p>
<h2 is-upgraded>å ´æ™¯ï¼šç™¼ç¾ä¸¦å®šä½æ•ˆèƒ½å•é¡Œ</h2>
<h3 is-upgraded>æ­¥é©Ÿ 1: æ³¨å…¥å»¶é²</h3>
<pre><code language="language-bash" class="language-bash"># å° service-b æ³¨å…¥ 1 ç§’å»¶é²
pumba netem --duration 5m delay --time 1000 o11y_lab_for_dummies-service-b-1
</code></pre>
<h3 is-upgraded>æ­¥é©Ÿ 2: ç”Ÿæˆæµé‡</h3>
<pre><code language="language-bash" class="language-bash"># åŸ·è¡Œ K6 æ¸¬è©¦
k6 run k6/load-test.js
</code></pre>
<h3 is-upgraded>æ­¥é©Ÿ 3: åœ¨ Prometheus ç™¼ç¾å•é¡Œ</h3>
<ol type="1">
<li>Grafana â†’ Explore â†’ Prometheus</li>
<li>æŸ¥è©¢: <pre><code language="language-promql" class="language-promql">histogram_quantile(0.95,
  rate(http_server_duration_milliseconds_bucket[1m])
)
</code></pre>
</li>
<li>ç™¼ç¾ P95 å»¶é²å¾ 100ms è·³åˆ° 1100ms</li>
</ol>
<h3 is-upgraded>æ­¥é©Ÿ 4: åœ¨ Tempo å®šä½æ…¢è«‹æ±‚</h3>
<ol type="1">
<li>åˆ‡æ›åˆ° Tempo</li>
<li>è¨­å®šç¯©é¸: <ul>
<li>Service: <code>service-b</code></li>
<li>Min Duration: <code>1s</code></li>
</ul>
</li>
<li>æ‰¾åˆ°æ…¢ traceï¼ŒæŸ¥çœ‹è©³æƒ…</li>
</ol>
<h3 is-upgraded>æ­¥é©Ÿ 5: åœ¨ Loki æŸ¥çœ‹ç›¸é—œæ—¥èªŒ</h3>
<ol type="1">
<li>åœ¨ trace è©³æƒ…ä¸­é»æ“Š &#34;Logs for this span&#34;</li>
<li>æˆ–è€…æ‰‹å‹•æŸ¥è©¢: <pre><code language="language-logql" class="language-logql">{service_name=&#34;service-b&#34;}
| json
| trace_id=&#34;&lt;your-trace-id&gt;&#34;
</code></pre>
</li>
<li>æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒå’Œæƒ…å¢ƒ</li>
</ol>
<h3 is-upgraded>æ­¥é©Ÿ 6: æ ¹å› åˆ†æ</h3>
<p>é€é trace waterfall åœ–ï¼Œä½ æœƒçœ‹åˆ°ï¼š</p>
<ul>
<li>service-b çš„æŸå€‹å…§éƒ¨æ“ä½œè€—æ™‚ 1000ms</li>
<li>é€™æ­£æ˜¯æˆ‘å€‘æ³¨å…¥çš„å»¶é²</li>
</ul>
<h3 is-upgraded>æ­¥é©Ÿ 7: é©—è­‰ä¿®å¾©ï¼ˆç§»é™¤å»¶é²ï¼‰</h3>
<pre><code language="language-bash" class="language-bash"># Pumba æ³¨å…¥æœƒè‡ªå‹•éæœŸï¼Œæˆ–æ‰‹å‹•é‡å•Ÿå®¹å™¨
docker compose restart service-b
</code></pre>
<p>å†æ¬¡åŸ·è¡Œ K6ï¼Œç¢ºèªå»¶é²æ¢å¾©æ­£å¸¸ã€‚</p>
<h2 is-upgraded>ç¸½çµå·¥ä½œæµç¨‹</h2>
<pre><code>Metrics (ç™¼ç¾ç•°å¸¸)
  â†’ Traces (å®šä½å…·é«”è«‹æ±‚)
    â†’ Logs (æŸ¥çœ‹è©³ç´°æƒ…å¢ƒ)
      â†’ æ ¹å› åˆ†æ
        â†’ ä¿®å¾©é©—è­‰
</code></pre>
<p>Positive : é€™å°±æ˜¯ç¾ä»£å¯è§€æ¸¬æ€§çš„å¨åŠ›ï¼</p>


      </google-codelab-step>
    
      <google-codelab-step label="æ¸…ç†å’Œå¾ŒçºŒå­¸ç¿’" duration="5">
        <h2 is-upgraded>åœæ­¢æ‰€æœ‰æœå‹™</h2>
<pre><code language="language-bash" class="language-bash"># åœæ­¢ä¸¦åˆªé™¤æ‰€æœ‰å®¹å™¨
docker compose down

# åŒæ™‚åˆªé™¤ volumesï¼ˆæ¸…ç†è³‡æ–™ï¼‰
docker compose down -v
</code></pre>
<h2 is-upgraded>å¾ŒçºŒå­¸ç¿’è³‡æº</h2>
<h3 is-upgraded>å®˜æ–¹æ–‡ä»¶</h3>
<ul>
<li><a href="https://opentelemetry.io/docs/" target="_blank">OpenTelemetry æ–‡ä»¶</a></li>
<li><a href="https://grafana.com/docs/" target="_blank">Grafana æ–‡ä»¶</a></li>
<li><a href="https://prometheus.io/docs/" target="_blank">Prometheus æ–‡ä»¶</a></li>
</ul>
<h3 is-upgraded>é€²éšä¸»é¡Œ</h3>
<ul>
<li><strong>æ¡æ¨£ç­–ç•¥</strong>: æ¸›å°‘è³‡æ–™é‡ï¼Œæ§åˆ¶æˆæœ¬</li>
<li><strong>å°¾éƒ¨æ¡æ¨£</strong>: åªä¿ç•™æœ‰åƒ¹å€¼çš„ traces</li>
<li><strong>å‘Šè­¦é…ç½®</strong>: åŸºæ–¼ metrics è¨­å®šå‘Šè­¦è¦å‰‡</li>
<li><strong>SLO/SLI</strong>: æœå‹™æ°´æº–ç›®æ¨™å’ŒæŒ‡æ¨™</li>
<li><strong>åˆ†æ•£å¼è¿½è¹¤çš„é€²éšæ¨¡å¼</strong>: Baggageã€Context Propagation</li>
</ul>
<h3 is-upgraded>ç¤¾ç¾¤è³‡æº</h3>
<ul>
<li><a href="https://github.com/open-telemetry" target="_blank">OpenTelemetry GitHub</a></li>
<li><a href="https://slack.cncf.io/" target="_blank">CNCF Slack</a> - #opentelemetry é »é“</li>
<li><a href="https://community.grafana.com/" target="_blank">Grafana Community</a></li>
</ul>
<h2 is-upgraded>ä½ å­¸åˆ°äº†ä»€éº¼</h2>
<p>æ­å–œï¼ä½ å·²ç¶“å®Œæˆäº†æ•´å€‹å¯¦é©—å®¤ã€‚ä½ ç¾åœ¨æŒæ¡äº†ï¼š</p>
<p>âœ… æ­å»ºå®Œæ•´çš„å¯è§€æ¸¬æ€§å †ç–Š âœ… Docker Compose éƒ¨ç½²å¾®æœå‹™ âœ… Python è‡ªå‹•å’Œæ‰‹å‹•åŸ‹é» âœ… K6 è² è¼‰æ¸¬è©¦ âœ… Pumba æ··æ²Œå·¥ç¨‹ âœ… Grafana ä¸‰å¤§æ”¯æŸ±é—œè¯ âœ… å®Œæ•´çš„å•é¡Œå®šä½æµç¨‹</p>
<h2 is-upgraded>ä¸‹ä¸€æ­¥</h2>
<ul>
<li>å˜—è©¦åœ¨è‡ªå·±çš„å°ˆæ¡ˆä¸­æ‡‰ç”¨é€™äº›æŠ€è¡“</li>
<li>æ¢ç´¢ Go æœå‹™çš„æ‰‹å‹•åŸ‹é»ï¼ˆservice-b/cï¼‰</li>
<li>é…ç½®è‡ªè¨‚å‘Šè­¦è¦å‰‡</li>
<li>å¯¦é©—ä¸åŒçš„æ¡æ¨£ç­–ç•¥</li>
</ul>
<p>Positive : æ„Ÿè¬å®Œæˆæœ¬æ•™å­¸ï¼å¯è§€æ¸¬æ€§ä¹‹æ—…æ‰å‰›å‰›é–‹å§‹ï¼</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
